# 8.1 ESLint를 활용한 정적 코드 분석

## 8.1.1 ESLint 살펴보기

### ESLint는 어떻게 코드를 분석할까?

- ESLint는 자바스크립트 코드를 정적 분석해 잠재적인 문제를 발견하고 나아가 수정까지 도와주는 도구입니다. ESLint의 분석 과정을 간단히 요약하면 다음과 같습니다.
  1. 자바스크립트 코드를 문자열로 읽는다.
  2. 자바스크립트 코드를 분석할 수 있는 파서(parser)로 코드를 구조화한다.
  3. 2번에서 구조화한 트리를 AST(Abstract Syntax Tree)라 하며, 이 구조화된 트리를 기준으로 각종 규칙과 대조한다.
  4. 규칙과 대조했을 때 이를 위반한 코드를 알리거나(report) 수정한다(fix).
- ESLint는 기본적으로 espree 파서를 사용합니다.
- espree의 분석 및 구조화된 결과
  - JavaScript
    ```jsx
    function hello(str) {}
    ```
  - espree의 JSON 형태의 구조화된 결과
    ```jsx
    {
    	"type": "Program",
    	"start": 0,
    	"end": 22,
    	"range": [0, 22],
    	"body": [
    		{
    			"type": "FunctionDeclaration",
    			"start", 0,
    			"end": 22,
    			"range": [0, 22],
    			"id: {
    				"type": "Identifier",
    				...
    			},
    			...
    			async: false,
    			"params": [
    				{
    				...
    				}
    			]
    			...
    		}
    	],
    	"sourceType": "module"
    }
    ```
- 한 줄밖에 안 되는 함수가 JSON으로 생성된 트리에 다양한 정보가 담겨 있음을 확인할 수 있습니다.
- ESLint가 espree로 분석한 결과를 바탕으로, 어떤 코드가 잘못된 코드고 어떻게 수정해야 하는지 정해야 합니다. 이를 ESLint 규칙(rule)이라고 하며, 특정한 규칙의 모음을 plugins라고 합니다.

## 8.1.2 eslint-plugin과 eslint-config

### eslint-plugin

- `eslint-plugin`이라는 접두사로 시작하는 플러그인은 앞서 언급했던 규칙을 모아놓은 패키지입니다. 예컨대 `eslint-plugin-import`는 모듈을 불러오는 `import`와 관련된 다양한 규칙을 제공하고, `eslint-plugin-react`는 리액트 관련 규칙을 제공합니다.

### eslint-config

- `eslint-config`는 이러한 `eslint-plugin`을 한데 묶어서 한 세트로 제공하는 패키지라고 볼 수 있습니다. 원하는 규칙들을 모아서 적용하는 것도 좋지만 설정 또한 만만치 않기 때문에 이미 존재하는 `eslint-config`를 설치하는 편이 일반적입니다.

ex) \*\*\*\*`eslint-config-airbnb`, `@titicaca/triple-config-kit`, `eslint-config-next`

## 8.1.3 나만의 ESLint 규칙 만들기

- `eslint-config`를 가져다가 쓴다고 해도 조직 내부적으로 규칙을 생성해야 하는 경우도 있습니다.
- 추후 규칙 생성 시 체크 예정

## 8.1.4 주의할 점

### Prettier와의 충돌

- Prettier는 코드 포매팅을 도와주는 도구인데, 두 패키지가 지향하는 목표는 다릅니다. ESLint는 코드의 잠재적인 문제가 될 수 있는 부분을 분석해 준다면, Prettier는 포매팅과 관련된 작업, 즉 줄바꿈, 들여쓰기, 작은따옴표와 큰따옴표 등을 담당합니다. 또한 Prettier는 자바스크립트뿐만 아니라 HTML, CSS, JSON 등 다양한 언어에도 적용 가능합니다. 자바스크립트의 경우 두 도구 모두 처리할 수 있기 때문에 충돌하는 규칙으로 인해 에러가 발생할 수 있습니다.
- 서로 규칙이 충돌하지 않게끔 나눠서 선언하거나, 자바스크립트나 타입스크립트는 ESLint에, 그 외 파일은 Prettier에 맡기는 형식으로 충돌 위험을 없앨 수 있습니다.

### 규칙에 대한 예외 처리, 그리고 react-hooks/no-exhaustive-deps

- 만약 일부 코드에서 특정 규칙을 임시로 제외시키고 싶다면 `eslint-disable-` 주석을 사용하면 됩니다. 특정 줄, 파일 전체, 혹은 특정 범위에 걸쳐 제외하는 것이 가능합니다.
- 리액트에서 이런 규칙을 가장 많이 사용하는 곳 중 하나가 `eslint-disable-line no-exhaustive-deps`입니다. 하지만 이런 경우 잠재적인 버그를 야기할 수 없는지 체크할 필요가 있습니다. 타입스크립트에서는 `typescript-eslint/no-explicit-any` 등을 사용하는 경우가 있는데, 그렇게 무시하는 것이 옳은지, 아니면 해당 규칙을 제거하는 것이 옳은지 꼭 다시 점검할 필요가 있습니다.

### ESLint 버전 충돌

- 예를 들어 `create-react-app`을 실행하면 설치되는 `react-scripts`의 5.0.1 버전에는 ESLint 8에 의존성을, `eslint-config-triple`은 ESLint 7에 의존성을 두고 있습니다. 이런 문제를 미연에 방지하려면 설치하고자 하는 `eslint-config`, `eslint-plugin`이 지원하는 ESLint 버전을 확인하고, 설치하고자 하는 프로젝트에서 어떤 ESLint를 사용하고 있는지 살펴봐야 합니다.
