# 4.1 서버 사이드 렌더링이란?

## 4.1.1 싱글 페이지 애플리케이션의 세상

### 싱글 페이지 애플리케이션이란?

- SPA는 렌더링과 라우팅에 필요한 대부분의 기능을 서버가 아닌 브라우저의 자바스크립트에 의존하는 방식을 의미합니다. 최초에 첫 페이지에서 데이터를 모두 불러온 이후에 페이지 전환을 위한 모든 작업이 자바스크립트와 브라우저의 history.pushState와 history.replaceState로 이뤄지기 때문에 하나의 페이지에서 모든 작업을 처리합니다.
- 이러한 작동 방식은 초기 렌더링해야 할 자바스크립트 리소스가 커진다는 단점이 있지만, 한번 로딩된 이후에는 서버를 거쳐서 리소스를 받아올 필요가 없기 때문에 사용자에게 쾌적한 UI/UX를 제공한다는 장점이 있습니다.

### 싱글 페이지 렌더링 방식의 유행과 JAM 스택의 등장

- 과거 PHP나 JSP(JavaServer Pages)를 기반의 웹 애플리케이션은 대부분의 렌더링이 서버 사이드에서 이뤄졌지만, 자바스크립트가 점점 다양한 작업을 수행하면서 자바스크립트 모듈화 방안이 논의되기 시작했습니다. 그에 따라 등장한 것이 CommonJS와 AMD(Asynchronous Module Definition)인데, 이러한 변화에 힙입어 2010년경 Backbone.js와 Angular.js, Knockout.js 등이 등장하면서 자바스크립트 수준에서 MVx 프레임워크를 구현하기 시작했습니다.
- 이후 자바스크립트의 역할이 더 가중되었고, 이후 우리가 잘 아는 React, Vue, Angular의 시대가 오게 됩니다. 기존의 웹 개발은 LAMP 스택, 즉 Linux(운영체제), Apache(서버), MySQL(데이터베이스), PHP/Python 등(웹 프레임워크)으로 구성돼 있었는데, 이는 인기 있는 개발 구조면서 동시에 한정적인 자바스크립트 작업으로 대부분의 처리를 서버에서 해야했기에 어쩔 수 없는 선택이기도 했습니다.
- 그러나 앞서 언급한 프레임워크의 등장으로 나온 것이 JAM(JavaScript, API, Markup) 스택인데, 프론트엔드는 자바스크립트와 마크업(HTML, CSS)을 미리 빌드해 두고 정적으로 제공하며, 이후 작동은 클라이언트에서 처리하기 때문에 서버 사이드 작업의 확장성 문제에서 좀 더 자유로워질 수 있게 됐습니다. JAM 스택의 인기와 Node.js의 고도화에 힘입어 MEAN(MongoDB, Express.js, AngularJS, Node.js)이나 MERN(MongoDB, Express.js, React, Node.js) 스택처럼 아예 API 서버 자체도 자바스크립트로 구현하는 구조가 인기를 끌었습니다.

### 새로운 패러다임의 웹서비스를 향한 요구

- 하지만 자바스크립트의 처리량이 점점 늘어나면서 다른 형식의 패러다임에 대한 요구가 늘어나기도 합니다.

## 4.1.2 서버 사이드 렌더링이란?

- 웹페이지가 점점 느려지는 상황에 대한 문제의식을 SPA의 태생적인 한계에서 찾고, 이를 개선하고자 서버에서 페이지를 렌더링해 제공하는 기존 방식의 웹 개발이 다시금 떠오르고 있습니다.
- 클라이언트의 렌더링은 사용자 기기 성능에 영향을 받지만, 서버 사이드 렌더링은 서버에서 제공하기 때문에 비교적 안정적인 렌더링이 가능합니다.

### 서버 사이드 렌더링의 장점

- 최초 페이지 진입이 빠르다
  - 서버가 사용자에게 렌더링을 제공할 만큼 충분한 리소스가 확보되어 있다는 가정하에 FCP(First Contentful Paint), 즉 사용자가 최초 페이지에 진입했을 때 페이지에 유의미한 정보가 그려지는 시간이 빨라질 수 있습니다. 일반적으로 서버에서 HTTP 요청과 HTML 그리는 작업이 빠르기 때문에 최초 페이지 진입이 빨라질 수 있습니다.
- 검색 엔진과 SNS 공유 등 메타데이터 제공이 쉽다
  - 검색 엔진의 봇은 클라이언트의 자바스크립트 실행 전에 정적인 정보를 가져오는 것이 주목적이기 때문에 클라이언트 사이드 렌더링의 경우 일부 불이익이 있을 수 있습니다. 최근 봇의 발전으로 변경점이 있을 수는 있습니다.
- 누적 레이아웃 이동이 적다
  - CLS(Cumulative Layout Shift), 즉 누적 레이아웃 이동을 줄일 수 있습니다. 클라이언트에서 API 호출이 제각각일 수 있고 그런 환경 때문에 레이아웃 이동이 있을 수 있어 사용자 경험에 좋지 않은 영향을 주게 됩니다.
- 사용자의 디바이스 성능에 비교적 자유롭다
  - 자바스크립트 리소스 실행은 사용자의 디바이스에서만 실행되므로 사용자 디바이스 성능에 의존적입니다. SSR에서는 서버와 이 부담을 나눠서 수행하기 때문에 상대적으로 자유로울 수 있습니다.
- 보안에 좀 더 안전하다
  - API 호출이나 민감 정보 등 모든 것을 클라이언트에서 노출된 채로 처리되기 때문에 서버에서 별도로 수행해서 던져주는 SSR에서는 상대적으로 보안 위협을 피할 수 있다는 장점이 있습니다.

### 서버 사이드 렌더링의 단점

- 소스코드를 작성할 때 항상 서버를 고려해야 한다
  - 브라우저 전역 객체인 window 또는 sessionStorage와 같이 브라우저에만 있는 전역 객체 등을 별도로 사용하고자 하거나 사용 중인 라이브러리에서 사용하는데, 이 코드가 서버에서 실행된다면 window is not defined 같은 에러를 마주하게 될 수도 있습니다.
- 적절한 서버가 구축돼 있어야 한다
  - 서버 내부에서 렌더링을 수행하고 요청 분산, 복구 전략 등 서버 구축과 서버 관리에 대한 부담이 있을 수 있습니다.
- 서비스 지연에 따른 문제
  - 로딩과 같은 서비스 지연에 따른 별도의 안내나 UI 요소를 제공하기가 CSR에 비해 수월하지 않은 부분이 있습니다.

## 4.1.3 SPA와 SSR을 모두 알아야 하는 이유

### 현대의 서버 사이드 렌더링

- 최근의 SSR은 기존의 LAMP 스택과 조금 차이가 있는데, 모든 페이지 질드를 서버에서 렌더링하는 것과 다르게 최초 진입에는 서버에서 완성된 HTML을 제공받고, 이후 라우팅에서는 내려받은 자바스크립트를 기반으로 SPA처럼 작동하기도 합니다.
