# Part 1 : ì• í”Œí›„ë ˆì‹œ

## Next.js ë§ì´ ì“°ëŠ” ì´ìœ ë¥¼ ì•Œì•„ë³´ì

- CSRë³´ë‹¤ SSRì´ ë‹¤ì‹œ ìœ í–‰í•¨
- client-side renderingì€ ë¸Œë¼ìš°ì €ì—ì„œ htmlì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•
- server-side renderingì€ ì„œë²„ì—ì„œ htmlì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë³´ë‚´ì¤Œ
- CSRì˜ ë¬¸ì œ â†’ ì´ì˜ê³  ë¶€ë“œëŸ¬ìš´ ì‚¬ì´íŠ¸ëŠ” ë§Œë“¤ ìˆ˜ ìˆìœ¼ë‚˜ êµ¬ê¸€ ê²€ìƒ‰ ë…¸ì¶œ, í˜ì´ì§€ ë¡œë”© ì†ë„
- SSR â†’ ì„œë²„ì—ì„œ ì›¹í˜ì´ì§€ë¥¼ ë‹¤ ë§Œë“¤ì–´ì„œ ë³´ë‚´ì£¼ê¸° ë•Œë¬¸ì— ìœ ì €í•œí…Œ JSë¥¼ ë³´ë‚¼ í•„ìš”ê°€ ì—†ì–´ì„œ ì¡°ê¸ˆ ë” ê°€ë³ê³ , êµ¬ê¸€ ê²€ìƒ‰ ë…¸ì¶œ, í˜ì´ì§€ ë¡œë”© ì†ë„ ì¢‹ìŒ + ì›í•˜ëŠ” ì˜ì—­ì—ì„œëŠ” CSRë¡œ ì²˜ë¦¬ ê°€ëŠ¥
- Next.js 13ë²„ì „ ì£¼ìš” ê¸°ëŠ¥
  - í´ë”ê¸°ë°˜ ìë™ë¼ìš°íŒ…
  - ìƒˆë¡œë””ìì¸í•œ ì„œë²„API ê¸°ëŠ¥
  - ì‰¬ìš´ DBì—°ê²°
  - ì§ê´€ì ì¸ rendering ì „ëµ ì„ íƒê¸°ëŠ¥
  - hydrationì—†ëŠ” server-side rendering
  - íŒŒì›Œí’€í•œ ìºì‹±
  - ì´ë¯¸ì§€ì™€ í°íŠ¸ ìµœì í™”

## Next.js ì„¤ì¹˜ì™€ ê°œë°œí™˜ê²½ ì…‹íŒ…

- nodejs 18ë²„ì „ ì´ìƒì—ì„œë§Œ ì˜ëŒì•„ê°
- node ë²„ì „ ë³€ê²½ ê´€ë ¨ ì°¸ê³  í¬ìŠ¤íŒ…
  - nvm ì‚¬ìš© ì¤‘ "C:\Users\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\AppData\Roaming\nvm could not be found or does not exist. Exiting.â€
    [nvm ìœˆë„ìš° ì„¤ì¹˜ ì¤‘ C:\Users\ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½\AppData\Roaming\nvm, The system cannot find the path specified. ë¬¸ì œ í•´ê²°](https://jinnnkcoding.tistory.com/189)
  - Node.js ìµœì‹  ë²„ì „ ì—…ë°ì´íŠ¸ì™€ ë²„ì „ ë³€ê²½ì´ ê°€ëŠ¥í•œ nvm ì‚¬ìš©í•˜ê¸°
    [[Node.js] Nodeì™€ NPM ë²„ì „ í™•ì¸ ë° ìµœì‹  ë²„ì „ ì—…ë°ì´íŠ¸](https://mine-it-record.tistory.com/664)
- npx create-next-app@latest
- í´ë”&íŒŒì¼ êµ¬ì¡°
  - app í´ë” â†’ ì½”ë“œ ì§¤ í´ë”
  - page.js â†’ ë©”ì¸ í˜ì´ì§€
  - layout.js â†’ page.jsë¥¼ ê°ì‹¸ëŠ” í˜ì´ì§€(êµ¬ì¡°ë¡œ ë³´ë©´ page.jsì˜ ë¶€ëª¨) â†’ page.js ë°”ê¹¥ì— ì ì–´ì¤˜ì•¼ í•  ì½”ë“œëŠ” ì—¬ê¸°ì— ì‘ì„± â†’ ex) head ë‚´ìš©, ìƒë‹¨ ê³ ì • ê¸°ëŠ¥ ë“±
  - globals.css â†’ ëª¨ë“  ì „ì—­ css
  - xxx.module.css â†’ íŠ¹ì • í˜ì´ì§€ì—ë§Œ ì ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ css
  - public í´ë” â†’ ì´ë¯¸ì§€ ë“± ì†ŒìŠ¤ì½”ë“œ ì™¸ì˜ íŒŒì¼ë“¤ ë³´ê´€ìš©
  - api í´ë” â†’ ì„œë²„ ê¸°ëŠ¥ ë§Œë“œëŠ” ê³³

## í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ë§Œë“¤ê¸° (React ê¸°ì´ˆë¬¸ë²•)

- Next.jsëŠ” React ìœ„ì— ì–¹í˜€ ì‚¬ëŠ” í”„ë ˆì„ì›Œí¬ ê°™ì€ ê±°ë¼ React ë¬¸ë²• ì‚¬ìš©
- ë¦¬ì•¡íŠ¸ë²„ì „ HTML íŠ¹ì§• 4ê°œ
  - return () ì•ˆì— HTML ë„£ì„ ë•Œ â†’ ë³‘ë ¬ êµ¬ì¡°ë¡œ ë„£ì„ ìˆ˜ ì—†ìŒ
  - class ë„£ê³  ì‹¶ìœ¼ë©´ â†’ className
- HTML ì•ˆì— ë³€ìˆ˜ ë„£ìœ¼ë ¤ë©´ â†’ { ë³€ìˆ˜ }
- inline style ì†ì„± ë„£ìœ¼ë ¤ë©´ â†’ style={{ color: â€˜redâ€™, fontSize: â€˜20pxâ€™ }} â†’ ê¸°ë³¸ì ìœ¼ë¡œ JavaScript object ìë£Œí˜•ì´ê¸° ë•Œë¬¸ì— keyê°’ì— ëŒ€ì‹œ ê¸°í˜¸ ê°™ì€ ê±¸ ì ì„ ìˆ˜ ì—†ìŒ â†’ ê·¸ë˜ì„œ ì¹´ë©œì¼€ì´ìŠ¤ë¡œ ì‘ì„±

- #í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ë§Œë“¤ ë•Œ ë ˆì´ì•„ì›ƒ ì•ˆì—ì„œ { children } ë„£ì–´ì¤˜ì•¼í•˜ê³ , ì¸ìë¡œë„ children ë„˜ê²¨ì¤˜ì•¼ í•¨

  ```jsx
  export default function CartLayout({ **children** }) {

    return (
      <div>
        <p>í˜„ì¹´ë¬´ì´ìì´ë²¤íŠ¸</p>
        **{children}**
      </div>
    )
  }
  ```

## ì—¬ëŸ¬ í˜ì´ì§€ ë§Œë“¤ê¸° (ë¼ìš°íŒ…)

- í´ë”ëª…ì´ routerì´ë¦„ì´ì urlì´ ë˜ëŠ” ê±°ê³ , í´ë” ë°‘ì—ëŠ” ë™ì¼í•˜ê²Œ page.jsë¡œ ì‘ëª…í•œ íŒŒì¼ â†’ ex) listë¼ëŠ” í´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ ì•„ë˜ page.jsëŠ” ë§Œë“¤ë©´, /listë¡œ ì ‘ì† ì‹œ page.js ë‚´ìš© ë³´ì—¬ì¤Œ
  1. appí´ë” ì•ˆì— í´ë” ë§Œë“¤ê³ (ê·¸ í´ë”ëª…ì´ urlì— ë¶™ëŠ” ì´ë¦„)
  2. ê·¸ ì•ˆì— page.js ë„£ê³ 
  3. ê·¸ ì•ˆì— ë ˆì´ì•„ì›ƒ ì‘ì—…
- í•´ë‹¹ í˜ì´ì§€ë¡œ ê°€ëŠ” ì‘ì—…ì„ í•  ë•ŒëŠ” <Link> â†’ a tagì™€ ë™ì¼í•˜ì§€ë§Œ ì¢€ ë” ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ë„˜ê²¨ì¤Œ

  ```jsx
  import Image from 'next/image'
  import styles from './page.module.css'
  **import Link from 'next/link'**

  export default function Home() {
    let name = 'park';
    let link = 'http://google.com'

    return (
      <main>
        <div className="navbar">
          **<Link href="/">í™ˆ</Link>
          <Link href="/list">List</Link>**
        </div>
        <h1 className="title">Programming Log</h1>
        <p className="title-sub">by dev kim</p>
      </main>
    )
  }
  ```

- headerë‚˜ gnb, footer ê°™ì´ í˜ì´ì§€ ì „ì²´ì—ì„œ ë…¸ì¶œë˜ì–´ì•¼ ë˜ëŠ” ì˜ì—­ì€ layout.js body ì•ˆì— ì‘ì„±

  ```jsx
  import "./globals.css";
  import { Inter } from "next/font/google";
  import Link from "next/link";

  const inter = Inter({ subsets: ["latin"] });

  export const metadata = {
    title: "Create Next App",
    description: "Generated by create next app",
  };

  export default function RootLayout({ children }) {
    return (
      <html lang="en">
        <body>
          <div className="navbar">
            <Link href="/">í™ˆ</Link>
            <Link href="/list">List</Link>
          </div>
          {children} // page.js ë“¤ì–´ê°€ëŠ” ë¶€ë¶„
        </body>
      </html>
    );
  }
  ```

- **page.js ë³´ì—¬ì¤„ ë•Œ**
  - ì˜†ì— layout.js ìˆìœ¼ë©´ ê·¸ê±¸ë¡œ page.js ì‹¸ë§´
  - ìƒìœ„í´ë”ì— layout.js ìˆìœ¼ë©´ ê·¸ê±¸ë¡œ 1ë²ˆ ì‹¸ë§´
  - ìƒìœ„í´ë”ì— ë˜ layout.jsê°€ ìˆìœ¼ë©´ ê·¸ê±¸ë¡œ 2ë²ˆ ì‹¸ë§´
  - (ìœ ì¹˜ì› ë²„ì „) page.js ë³´ì—¬ì¤„ ë•ŒëŠ” ì˜†ì—, ìƒìœ„ì— ìˆëŠ” ëª¨ë“  layout.js í•©ì³ì„œ ë³´ì—¬ì¤Œ
  - í˜ì´ì§€ ë³€ê²½ê³¼ ìƒê´€ì—†ì´ ê³„ì† ë³´ì—¬ì¤„ UIëŠ” layout.js ì“°ë©´ í¸í• ì§€ë„

## htmlì„ ë°˜ë³µë¬¸ìœ¼ë¡œ ì¤„ì´ê³  ì‹¶ìœ¼ë©´ map

```jsx
export default function List() {
  let ìƒí’ˆ = ["Tomatoes", "Pasta", "Coconut"];

  return (
    <div>
      <h2 className="title">ìƒí’ˆëª©ë¡</h2>
      {ìƒí’ˆ.map((item) => {
        return (
          <div className="food">
            <h4>{item} $40</h4>
          </div>
        );
      })}
    </div>
  );
}
```

## Next.jsì—ì„œ ì´ë¯¸ì§€ ë„£ëŠ” ë²• 2ê°œ

- public í´ë” ë°‘ì—ì„œ ì´ë¯¸ì§€ ê´€ë¦¬í•˜ê³  ê²½ë¡œ ê°€ì ¸ì˜¬ ë•Œ `/food0.png` ì²˜ëŸ¼ / ì—ì„œ ë°”ë¡œ ì ‘ê·¼ ê°€ëŠ¥
- ì´ë¯¸ì§€ë¥¼ ë¿Œë¦´ ë•Œ ìµœì í™”ëœ ì´ë¯¸ì§€ë¡œ ë„£ì„ ìˆ˜ ìˆìŒ
  - lazy loading, ì‚¬ì´ì¦ˆìµœì í™” â†’ ì´ë¯¸ì§€ê°€ ëŠ¦ê²Œ ë– ì„œ ë°€ë ¤ë‚˜ëŠ” layout shift í˜„ìƒ ë°©ì§€
- ìµœì í™”ëœ ì´ë¯¸ì§€ ë„£ìœ¼ë ¤ë©´
  - import Image from â€˜next/imageâ€™
  - <Image /> ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©
- ìµœì í™” ê°€ëŠ¥í•œ <Image /> ì»´í¬ë„ŒíŠ¸ ì œì•½ ì¡°ê±´
  - ì´ë¯¸ì§€ ê²½ë¡œë¥¼ importí•´ì„œ ë„£ëŠ” ë°©ì‹ìœ¼ë¡œë§Œ í•´ì•¼ í•¨
  - ë°˜ë³µë¬¸ì„ ëŒë ¤ì•¼ í•˜ëŠ” ê²½ìš° src ì•ˆì— require(â€™ì´ë¯¸ì§€ê²½ë¡œâ€™) ê°™ì´ ë³„ë„ì˜ ë¬¸ë²• ì ìš© í•„ìš”
  - ì™¸ë¶€ ì´ë¯¸ì§€ ë§í¬ë¥¼ ë„£ê³  ì‹¶ìœ¼ë©´ width, height ì†ì„±ì´ ì •í™•íˆ í•„ìš”í•˜ê³  next.config.jsì—ì„œ ë³„ë„ remotePatterns ì„¸íŒ… í•„ìš”í•¨
  - ë•Œë¬¸ì— ë‹¤ ë§Œë“  í›„ì— ìµœì í™”í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ

## client/server component, import ë¬¸ë²•

- Next.js ì»´í¬ë„ŒíŠ¸ëŠ” ì¢…ë¥˜ê°€ 2ê°œ â†’ server component / client component
- ì•„ë¬´ë°ë‚˜ ì„ ì–¸í•´ì„œ ë§Œë“  ê±´ server component
- **íŒŒì¼ ë§¨ ìœ„ì— â€˜use clientâ€™ ë„£ê³  ë§Œë“  ê±´ client component**
- **server component - htmlì— ìë°”ìŠ¤í¬ë¦½íŠ¸ ê¸°ëŠ¥ ë„£ê¸° ë¶ˆê°€ëŠ¥, useState, useEffect ë“± ì‚¬ìš© ë¶ˆê°€**
- â€˜use clientâ€™ ì„ ì–¸í•˜ê³  client componentë¡œ ë³€ê²½í•˜ë©´ ì‚¬ìš© ê°€ëŠ¥
- **client component ê°œë°œ ìš©ì´í•¨, ë¡œë”© ì†ë„ ëŠë¦¼(ìë°”ìŠ¤í¬ë¦½íŠ¸ ë§ì´ í•„ìš”, hydration í•„ìš”)**
  - hydration - htmlì„ ìœ ì €ì—ê²Œ ë³´ë‚¸ í›„ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ html ë‹¤ì‹œ ì½ê³  ë¶„ì„í•˜ëŠ” ì¼
- **server component ë¡œë”©ì†ë„ ë¹ ë¦„(í° í˜ì´ì§€ì— ì¶”ì²œ)**
- **JS ê¸°ëŠ¥ í•„ìš”í•œ ì‘ì€ í˜ì´ì§€ì—ëŠ” client component**

## Componentì— ë°ì´í„° ì „í•´ì£¼ë ¤ë©´ props

- ë¦¬ì•¡íŠ¸ ë¬¸ë²•ê³¼ ë™ì¼í•¨
- ì¤‘ê´„í˜¸ ì—´ë©´ ë³€ìˆ˜, í•¨ìˆ˜ ë“± ì•„ë¬´ê±°ë‚˜ ì „ì†¡ ê°€ëŠ¥
- ë¶€ëª¨ â†’ ìì‹ ì „ì†¡ ê°€ëŠ¥, ìì‹ â†’ ë¶€ëª¨, ì˜†ì§‘ë¼ë¦¬ props ì „ì†¡ ë¶ˆê°€ëŠ¥
- ë°ì´í„°ê°€ ë§ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°€ê¸‰ì  ê·¸ë“¤ ì¤‘ ìµœê³  ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ë³´ê´€í•´ì•¼ ì¢‹ìŒ
- **#ê°™ì€ ë°ì´í„°ë¥¼ ë¶€ëª¨ì—ì„œ, ìì‹ì—ì„œ ë˜ í•œë²ˆ ë‘ ë²ˆ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆìœ¼ë‚˜ ë‹¤ë¥¸ Vue, Reactì—ì„œëŠ” ë‘ ë²ˆ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— ë¹„íš¨ìœ¨ì ì¸ë°, Next.jsì—ì„œëŠ” ê°™ì€ ë°ì´í„° ìš”ì²­ì´ ì—¬ëŸ¬ ê°œë©´ 1ê°œë¡œ ì••ì¶•í•´ì¤Œ(deduplication ê¸°ëŠ¥)**

## \***\*ì¢‹ì•„ìš” ë²„íŠ¼ ë§Œë“¤ê¸° (useState, onClick)\*\***

- useState, ì´ë²¤íŠ¸ ì„¤ëª… ë¦¬ì•¡íŠ¸ì™€ ë™ì¼í•¨

## ì¢‹ì•„ìš” ë²„íŠ¼ ë§Œë“¤ê¸° 2 (array, object state ë³€ê²½í•˜ë ¤ë©´)

- array, object ê´€ë ¨ ì„¤ëª… ë¦¬ì•¡íŠ¸ì™€ ë™ì¼í•¨
- ê¹Šì€ë³µì‚¬, ì–‡ì€ë³µì‚¬, reference data type ê´€ë ¨ ë‚´ìš©
  let arr = [1, 2, 3]
  let arr2 = arr
  **console.log(arr2 == arr) // arr2 ê°’ì´ ë°”ë€Œë”ë¼ë„ trueì„, RAMì— ë‹´ê¸´ ê·¸ ê°’ì„ ê°€ë¦¬í‚¤ëŠ” í™”ì‚´í‘œê°€ ë™ì¼í•˜ê²Œ ë•Œë¬¸, ë¹„êµì—°ì‚°ìë¡œëŠ” array data ìì²´ê°€ ì•„ë‹Œ í™”ì‚´í‘œë§Œ ë¹„êµ ê°€ëŠ¥**

# Part 2 : ê²Œì‹œíŒ í”„ë¡œì íŠ¸

## **ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ìƒì„± / MongoDB ì…‹íŒ…**

- Database
  - ê´€ê³„í˜• Database â†’ PostgreSQL, MySQL, ORACLE â†’ ë°ì´í„°ë¥¼ ë§ˆì¹˜ ì—‘ì…€ì²˜ëŸ¼ í‘œë¡œ ê´€ë¦¬ ê°€ëŠ¥
  - ë¹„ê´€ê³„í˜• Database â†’ mongoDB, Cloud Firestore, cassandra â†’ ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½, ë¶„ì‚°ì²˜ë¦¬ ì˜í•´ì¤Œ
    ex) mongoDB â†’ JS object ìë£Œí˜•ì²˜ëŸ¼ ë°ì´í„° ì €ì¥ ê°€ëŠ¥

## \***\*Next.jsì—ì„œ MongoDB ì‚¬ìš©í•˜ê¸°\*\***

### ë°ì´í„° ì‚½ì… ì‘ì—…

- [mongodb.com](http://mongodb.com) â†’ Database â†’ Browse Collections â†’ Add My Own Data
- databaseëŠ” ê·¸ëƒ¥ í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ë¼ê³  ì´í•´í•˜ë©´ ì¢‹ìŒ
  - ë•Œë¡œëŠ” í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ê°€ ì—¬ëŸ¬ ê°œì˜ databaseë¥¼ ìš´ì˜í•  ìˆ˜ë„ ìˆìŒ
- collectionì€ í•˜ë‚˜ì˜ í´ë”ë¼ê³  ì´í•´í•˜ë©´ ì¢‹ìŒ
- documentëŠ” í•˜ë‚˜ì˜ ë©”ëª¨ì¥ íŒŒì¼ â†’ ì‹¤ì œ ë°ì´í„°ëŠ” documentì— { } í˜•ì‹ìœ¼ë¡œ ê¸°ë¡
- **collectionì´ë¼ëŠ” í´ë”ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³  ê·¸ ì•ˆì— documentë¼ëŠ” ê±¸ ë§Œë“¤ì–´ì„œ ê·¸ ì•ˆì— object ìë£Œí˜• ê°™ì€ ê±¸ ë³´ê´€**
- í•´ë‹¹ collectionì— ì ‘ê·¼í•´ì„œ insert documentë¥¼ í†µí•´ ìë£Œ ì‚½ì…

### Next.js ë‚´ MongoDB ì„¸íŒ…

- **MongoDB ì„¤ì¹˜** - \*\*\*\*npm i mongodb
- **MongoDB ì ‘ì†** - í˜¸ì¶œí•˜ê³ ì í•˜ëŠ” í˜ì´ì§€ì—ì„œ í˜¸ì¶œ

  ```jsx
  import { MongoClient } from "mongodb";

  export default async function Home() {
    const url =
      "mongodb+srv://admin:<password>@cluster0.tjgi6mq.mongodb.net/?retryWrites=true&w=majority";
    const client = await MongoClient.connect(url, {
      // DBì ‘ì†ìš© url
      useNewUrlParser: true,
    });
    const db = client.db("forum"); // ì ‘ì†í•˜ê³ ì í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„(ex) forum)
    db.collection("post").find();

    return <div>Home</div>;
  }
  ```

- ì €ë ‡ê²Œ ì§œë©´ í•´ë‹¹ í˜ì´ì§€ì—ì„œ ê³„ì† `connect()`ë¥¼ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— ë³„ë„ì˜ íŒŒì¼ë¡œ ì§œì„œ í˜¸ì¶œí•´ì˜´

  ```jsx
  // util\database.js

  import { MongoClient } from "mongodb";
  const url =
    "mongodb+srv://admin:<password>@cluster0.tjgi6mq.mongodb.net/?retryWrites=true&w=majority";
  const options = { useNewUrlParser: true };
  let connectDB;

  if (process.env.NODE_ENV === "development") {
    // global ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ê°œë°œ ë‹¨ê³„ì—ì„  connect()ê°€ ì—°ì†ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ë¶„ê¸°ì²˜ë¦¬ "ê°œë°œì¤‘ ìƒíƒœë©´ globalì´ë¼ëŠ” ì „ì—­ë³€ìˆ˜ ì €ì¥ì†Œì— ë³´ê´€í•´ì£¼ì„¸ìš”"
    if (!global._mongo) {
      global._mongo = new MongoClient(url, options).connect();
    }
    connectDB = global._mongo;
  } else {
    connectDB = new MongoClient(url, options).connect();
  }
  export { connectDB };
  ```

  ```jsx
  // app\page.js

  import { connectDB } from "@/util/database.js"; // ì‚¬ì´íŠ¸ ë£¨íŠ¸ ê²½ë¡œë¶€í„° ì‹œì‘í•˜ë ¤ë©´ / ì•„ë‹ˆë©´ @/

  export default async function Home() {
    const client = await connectDB; // db ì ‘ì†
    const db = client.db("forum");
    let result = await db.collection("post").find().toArray(); // 'post' ì½œë ‰ì…˜ì— ìˆëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ë‹¬ë¼
    console.log("result", result);

    return <div>Home</div>;
  }
  ```

- DB ì…ì¶œë ¥ ì½”ë“œëŠ” server component ì•ˆì—ì„œë§Œ ì‘ì„±í•˜ëŠ” ê²Œ ì¢‹ìŒ â†’ client componentëŠ” ëœë”ë§í•´ì„œ ìœ ì €ì—ê²Œ ëª¨ë“  ì½”ë“œê°€ ë‚ ì•„ê°€ê¸° ë•Œë¬¸ì— ë¯¼ê°í•œ ì½”ë“œëŠ” server component ì•ˆì—ì„œ ì‘ì„±

## ê¸€ëª©ë¡ ì¡°íšŒê¸°ëŠ¥ ë§Œë“¤ê¸° (DB ë°ì´í„° ì¶œë ¥)

- ìƒë‹¨ì²˜ëŸ¼ í•´ë‹¹ collection ê°€ì ¸ì™€ì„œ map í•¨ìˆ˜ë¡œ ë°˜ë³µë¬¸ ë¿Œë¦¬ëŠ” ê°™ì€ ë‚´ìš©
- async, awaitì—ì„œ awaitëŠ” Promise ë±‰ëŠ” ì½”ë“œë§Œ ì‚¬ìš© ê°€ëŠ¥

## ìƒì„¸í˜ì´ì§€ ë§Œë“¤ê¸° 1 (c)

- detail í´ë” ë°‘ì— [ì•„ë¬´ì´ë¦„] í´ë” ë§Œë“¤ê³  ê·¸ ë°‘ì— page.js ê´€ë¦¬í•˜ë©´ detail/ì•„ë¬´ì´ë¦„ ìœ¼ë¡œ í•´ë‹¹ í˜ì´ì§€ ì ‘ê·¼ ê°€ëŠ¥ â†’ ì¦‰ Dynamicí•˜ê²Œ ë¼ìš°íŒ…í•  ìˆ˜ ìˆìŒ ex) http://localhost:3000/detail/adsadad
- mongoDBì—ì„œ í•˜ë‚˜ì˜ documentë§Œ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë• `find()`ê°€ ì•„ë‹Œ `findOne()` â†’ ì¸ìë¡œëŠ” ì°¾ê³  ì‹¶ì€ key: valueë¥¼ objectë¡œ ë„£ì–´ì¤Œ
- ê¸°ë³¸ì ìœ¼ë¡œ ë³„ë„ì˜ ê°’ì„ ì „ë‹¬í•˜ì§€ ì•Šì€ propsë¥¼ ì¶œë ¥í•´ë³´ë©´ paramsë¥¼ ë“¤ê³  ìˆìŒ
  `{ params: { id: '1' }, searchParams: {} }`

  ```jsx
  import { connectDB } from "@/util/database";
  import { ObjectId } from "mongodb";

  export default async function Detail(props) {
    const db = (await connectDB).db("forum");
    let result = await db
      .collection("post")
      .findOne({ _id: new ObjectId(props.params.id) });
    console.log(props.params.id);
    return (
      <div>
        <h4>ìƒì„¸í˜ì´ì§€</h4>
        <h4>{result.title}</h4>
        <p>{result.content}</p>
      </div>
    );
  }
  ```

## ìƒì„¸í˜ì´ì§€ ë§Œë“¤ê¸° 2 (useRouter) - â€˜use clientâ€™ì—ì„œ ì‚¬ìš© ê°€ëŠ¥

- useRouterë¥¼ ì‚¬ìš©í•œ ì˜ˆì œ

  ```jsx
  "use client";

  import { useRouter } from "next/navigation";

  export default function DetailLink() {
    let router = useRouter();
    return (
      <button
        onClick={() => {
          router.push("/");
        }}
      >
        ë²„íŠ¼
      </button>
    );
  }
  ```

- **SSRì—ì„œ <Link> ì»´í¬ë„ŒíŠ¸ë¥¼ ì“°ë©´ ë˜ëŠ”ë° ì™œ êµ³ì´ useRouterë¥¼ ì“°ëŠ”ê°€? â†’ ê·¸ ì™¸ì— ë³„ë„ì˜ ê¸°ëŠ¥ë“¤ì´ í•„ìš”í•  ë•Œ**
- **router ê´€ë ¨ í•¨ìˆ˜ë“¤**
  - router.back() â†’ ë’¤ë¡œ ê°€ê¸°
  - router.forward() â†’ ì•ìœ¼ë¡œ ê°€ê¸°
  - router.refresh() â†’ ì†Œí”„íŠ¸ ë¦¬í”„ë ˆì‹œ
  - router.prefetch(â€™/ì–´ì©Œêµ¬â€™) â†’ ì–´ì©Œêµ¬ì˜ ë‚´ìš©ì„ ë¯¸ë¦¬ ë¡œë“œí•´ì¤Œ â†’ ê·¸ í˜ì´ì§€ ë°©ë¬¸í•  ë•Œ ë§¤ìš° ë¹ ë¥´ê²Œ ë°©ë¬¸ ê°€ëŠ¥
  - **server componentì—ë„ <Link> ì»´í¬ë„ŒíŠ¸ì— prefetch ê¸°ë³¸ìœ¼ë¡œ ì ìš©ë˜ì–´ ìˆìŒ â†’ ì›ì¹˜ ì•Šìœ¼ë©´ refetch={false} ì ìš©**
    - ê°œë°œì¤‘ì¼ ë• prefetch ì—¬ë¶€ í™•ì¸ë¶ˆê°€
    - ex) ê²Œì‹œíŒ ëª©ë¡ì˜ ê²½ìš° ëª¨ë“  ê¸€ì„ prefetchí•˜ëŠ” ê²Œ ë¶€ë‹´ìŠ¤ëŸ½ê³  ë¶ˆí•„ìš”í•¨
      ```jsx
      <Link href={"/ì–´ì©Œêµ¬"} prefetch={false}>
        ë§í¬
      </Link>
      ```
- navigation ê´€ë ¨ í•¨ìˆ˜ë“¤

  ```jsx
  "use client";

  import { usePathname, useSearchParams, useParams } from "next/navigation";

  export default function DetailLink() {
    let a = usePathname(); // í˜„ì¬ URL ì¶œë ¥
    let b = useSearchParams(); // Search parameter ì¶œë ¥
    let c = useParams(); // dynamic routeì— ì…ë ¥í•œ ê±° ì¶œë ¥
    console.log(a);
  }
  ```

## ê¸€ ì‘ì„±ê¸°ëŠ¥ ë§Œë“¤ê¸° 1 (ì„œë²„ê¸°ëŠ¥ ê°œë°œì€)

- ìœ ì €ê°€ ì‘ì„±í•œ ê¸€ì„ ë°”ë¡œ DBë¡œ ë°›ëŠ” ê±´ ìœ íš¨ì„± ë¶€ë¶„ë„ ê·¸ë ‡ê³  ì•…ì„±ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë³´ë‚¼ ìˆ˜ë„ ìˆì–´ì„œ ì•ˆì „í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¤‘ê°„ì— ê¸€ì„ ì²´í¬í•˜ê³  ì´ìƒì´ ì—†ìœ¼ë©´ DBì— ì €ì¥ â†’ **3-tier architecture**, ê·¸ ì¤‘ê°„ì´ ì„œë²„
- ê·¸ ì¤‘ê°„ ì—­í• ì„ í•˜ëŠ” ì„œë²„ì—ì„œ api ì‘ì„±, URLê³¼ methodê°€ í•„ìš”í•¨(GET, POST, PUT, DELETE, PATCH)
- ì›ë˜ëŠ” api url ì£¼ì†Œì™€ GET ìš”ì²­í•˜ë©´ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ”ë°, Next.jsì˜ ê²½ìš° ìë™ ë¼ìš°íŒ…ì´ ë˜ì–´ ìˆì–´ì„œ /api/test ë¡œ GET/POST/PUT/DELETE/PATCH ìš”ì²­í•˜ë©´ íŒŒì¼ ì•ˆì— ì½”ë“œ ì‹¤í–‰í•´ì¤Œ
- GET ìš”ì²­ ì‘ì„±
  - ì„œë²„ëŠ” ê¸°ëŠ¥ ì‹¤í–‰ í›„ì— ìœ ì €ì—ê²Œ ì‘ë‹µí•´ì¤˜ì•¼ í•¨(ìš”ì²­/ì‘ë‹µ)
  - ì²˜ë¦¬ ì„±ê³µ status(200), ì²˜ë¦¬ ì‹¤íŒ¨ status(500), ìœ ì €ì˜ëª»ìœ¼ë¡œ ì¸í•œ ê¸°ëŠ¥ ì‹¤íŒ¨ status(400)
    ```jsx
    export default function handler(ìš”ì²­, ì‘ë‹µ) {
      console.log(123);
      return ì‘ë‹µ.status(200).json("ì²˜ë¦¬ì™„ë£Œ"); // ìš”ì²­ì„ ë°›ì•„ì”…ë©´ ì‘ë‹µì„ í•´ì£¼ëŠ” ê²Œ ì¢‹ìŒ
    }
    ```
- **form tag ì‚¬ìš©í•´ì„œ GET, POST ìš”ì²­ ê°€ëŠ¥ - actionì—ëŠ” URL ì˜ ê¸°ì…í•˜ê³  methodì—ëŠ” GET, POST ì¤‘ì— í•˜ë‚˜ ê¸°ì…í•˜ë©´ ë©ë‹ˆë‹¤. (PUT, DELETEëŠ” ëª»ì”ë‹ˆë‹¤)**

  ```jsx
  // (app/write/page.js)

  export default function Write() {
    return (
      <div>
        <h4>ê¸€ì‘ì„±</h4>
        <form action="/api/test" method="POST">
          <button type="submit">ë²„íŠ¼</button>
        </form>
      </div>
    );
  }
  ```

  ```jsx
  // pages\api\post\new.js

  import { connectDB } from "@/util/database";

  export default async function handler(req, res) {
    console.log(req.body);
    if (req.method === "POST") {
      if (req.body.title === "") {
        return res.status(500).json("ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤");
      }

      try {
        const db = (await connectDB).db("forum");
        let result = await db.collection("post").insertOne(req.body);
        return res.status(200).redirect("/list");
      } catch (error) {
        console.log(error);
      }
    }
  }
  ```

- íšŒì›ê°€ì… ê³¼ì œ

  ```jsx
  // app\join\page.js

  export default function Join() {
    return (
      <div>
        <form action="/api/join/new" method="POST">
          <input type="text" name="id" />
          <input type="password" name="password" />
          <button type="submit">íšŒì›ê°€ì…</button>
        </form>
      </div>
    );
  }
  ```

```jsx
// pages\api\join\new.js

import { connectDB } from "@/util/database";

export default async function handler(req, res) {
  const client = await connectDB;
  const db = client.db("forum");
  let result = await db.collection("user").find().toArray();
  console.log(result);

  if (req.method === "POST") {
    for (let i = 0; i < result.length; i++) {
      if (req.body.id === result[i].id) {
        return res.status(500).json("ì¤‘ë³µì•„ì´ë””");
      }
    }

    try {
      const db = (await connectDB).db("forum");
      let result = await db.collection("user").insertOne(req.body);
      return res.status(200).json("íšŒì›ê°€ì…ì™„ë£Œ");
    } catch (error) {
      console.log(error);
    }
  }
}
```

## ìˆ˜ì •ê¸°ëŠ¥ ë§Œë“¤ê¸° 1

ë©”ëª¨ ì—†ìŒ

## ìˆ˜ì •ê¸°ëŠ¥ ë§Œë“¤ê¸° 2

- app\edit\[id]\page.js

  ```jsx
  import { connectDB } from "@/util/database";
  import { ObjectId } from "mongodb";

  export default async function Edit(props) {
    const db = (await connectDB).db("forum");
    let result = await db
      .collection("post")
      .findOne({ _id: new ObjectId(props.params.id) });

    console.log("result", result);

    return (
      <div className="p-20">
        <h4>ìˆ˜ì •í˜ì´ì§€</h4>
        <form action="/api/post/edit" method="POST">
          <input name="_id" type="text" defaultValue={result._id.toString()} />
          <input
            name="title"
            type="text"
            defaultValue={result.title}
            placeholder="ì œëª©"
          />
          <input
            name="content"
            type="text"
            placeholder="ë‚´ìš©"
            defaultValue={result.content}
          />
          <button type="submit">ì „ì†¡</button>
        </form>
      </div>
    );
  }
  ```

- pages\api\post\edit.js

  ```jsx
  import { connectDB } from "@/util/database";

  export default async function handler(req, res) {
    console.log(req.body);
    if (req.method === "POST") {
      if (req.body.title === "") {
        return res.status(500).json("ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤");
      }

      try {
        const db = (await connectDB).db("forum");
        let result = await db.collection("post").insertOne(req.body);
        return res.status(200).redirect("/list");
      } catch (error) {
        console.log(error);
      }
    }
  }
  ```

## ì‚­ì œê¸°ëŠ¥ ë§Œë“¤ê¸° 1 (Ajax)

- ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ ê¸€ ì‚­ì œë¥¼ ì§„í–‰í–ˆì„ ë•Œ í˜ì´ì§€ì˜ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì²˜ë¦¬í•˜ê³ ì í•˜ë©´ ì „ì²´ í˜ì´ì§€ëŠ” SSRë¡œ ë‘ë˜ ì‚­ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì˜ì—­ë§Œ ì»´í¬ë„ŒíŠ¸ë¡œ ë¹¼ì„œ CSRë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ
- SSRì—ì„œ propsë¥¼ í†µí•´ì„œ ë°ì´í„°ë¥¼ ë‚´ë ¤ì¤˜ë„ ë˜ê³ , ì»´í¬ë„ŒíŠ¸ ì˜ì—­ ì•ˆì—ì„œ ë°”ë¡œ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ë„ ë˜ì§€ë§Œ CSRì´ê¸° ë•Œë¬¸ì— êµ¬ê¸€ ì„œì¹˜ ê²°ê³¼ë‚˜ ì´ëŸ° ë¶€ë¶„ì—ì„œ ë‹¨ì ì´ ìˆìŒ â†’ ì¦‰, SSRì˜ propsë¡œ ë‚´ë ¤ì£¼ëŠ” í¸ì´ ë‚˜ìŒ

  ```jsx
  // app\list\page.js

  import { connectDB } from "@/util/database";
  import ListItem from "./ListItem";

  export default async function List() {
    const db = (await connectDB).db("forum");
    let result = await db.collection("post").find().toArray();
    console.log("result", result);

    return (
      <div className="list-bg">
        <ListItem result={result} />
      </div>
    );
  }
  ```

  ```jsx
  // app\list\ListItem.js

  "use client";

  import Link from "next/link";
  import DetailLink from "./DetailLink";

  export default function ListItem(props) {
    console.log("props", props);
    let { result } = props;

    return (
      <div>
        {result.map((item) => {
          return (
            <div key={item._id} className="list-item">
              <Link
                style={{ display: "inline-block" }}
                href={`/detail/${item._id}`}
              >
                <h4>{item.title}</h4>
              </Link>
              <Link href={`/edit/${item._id}`}>ğŸ–‹</Link>
              <span
                onClick={() => {
                  // fetch('/url', {
                  //   method: 'DELETE',
                  //   body: JSON.stringify([])
                  // })
                  // .then(() => {
                  // })
                }}
              >
                ğŸ§»
              </span>
              <DetailLink />
              <p>1ì›” 1ì¼</p>
            </div>
          );
        })}
      </div>
    );
  }
  ```

## ì‚­ì œê¸°ëŠ¥ ë§Œë“¤ê¸° 2 (Ajax ì¶”ê°€ë‚´ìš©ê³¼ ì—ëŸ¬ì²˜ë¦¬)

- **ì„œë²„ë¡œ array, object ë³´ë‚¼ ë• JSON.stringify()ë¡œ ì²˜ë¦¬ â†’ ë‹¹ì—°íˆ ë°›ì•„ì˜¬ ë•ŒëŠ” JSON.parse()**
- DELETE ìš”ì²­ ì‹œ ë°ì´í„°ê°€ ì•ˆ ê°€ëŠ” ê²½ìš°ê°€ ê°€ë” ìˆìŒ â†’ ê·¸ëŸ´ ë• POSTë¡œ ì²˜ë¦¬
- ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„ ë° ajax ì—ëŸ¬ ì²˜ë¦¬ ì¶”ê°€
- ajax ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ fetch í•¨ìˆ˜ì˜ ë¬¸ë²•ì„ ê°„ì†Œí™”í•˜ê¸° ìœ„í•´ axios ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

  ```jsx
  // app\list\ListItem.js

  "use client";

  import Link from "next/link";
  import DetailLink from "./DetailLink";

  export default function ListItem(props) {
    console.log("props", props);
    let { result } = props;

    return (
      <div>
        {result.map((item) => {
          return (
            <div key={item._id} className="list-item">
              <Link
                style={{ display: "inline-block" }}
                href={`/detail/${item._id}`}
              >
                <h4>{item.title}</h4>
              </Link>
              <Link href={`/edit/${item._id}`}>ğŸ–‹</Link>
              <span
                onClick={() => {
                  fetch("/api/post/delete", {
                    method: "DELETE",
                    body: item._id,
                  })
                    .then((r) => {
                      if (r.status === 200) {
                        return r.json();
                      } else {
                        // ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œ ì „ì†¡ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
                      }
                    })
                    .then((result) => {
                      // ì„±ê³µì‹œ ì‹¤í–‰í•  ì½”ë“œ
                    })
                    .catch((error) => {
                      // ì¸í„°ë„· ë¬¸ì œë¡œ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰í•  ì½”ë“œ
                      console.log(error);
                    });
                }}
              >
                ğŸ§»
              </span>
              <DetailLink />
              <p>1ì›” 1ì¼</p>
            </div>
          );
        })}
      </div>
    );
  }
  ```

  ```jsx
  // pages\api\post\delete.js

  import { connectDB } from "@/util/database";
  import { ObjectId } from "mongodb";

  export default async function handler(req, res) {
    if (req.method === "DELETE") {
      try {
        const db = (await connectDB).db("forum");
        let result = await db
          .collection("post")
          .deleteOne({ _id: new ObjectId(req.body) });
        console.log(result);
        return res.status(200).json("ì‚­ì œì™„ë£Œ");
      } catch (error) {
        console.log(error);
      }
    }
  }
  ```

## ì‚­ì œê¸°ëŠ¥ ë§Œë“¤ê¸° 3 (query string / URL parameter)

- animation ê°™ì€ ê²½ìš°ì— ì—¬ëŸ¬ ë°©ë²•ì´ ìˆê² ì§€ë§Œ ì§ì ‘ DOMì— ì ‘ê·¼í•´ì„œ styleì„ ë°”ê¿ˆìœ¼ë¡œì„œ ì¤„ ìˆ˜ ìˆìŒ
- í•´ë‹¹ elementì— { opacity: 1; trasition: all 1s; } ì •ë„ë¥¼ ì¤€ í›„ì—, eventê°€ ë°œìƒí•˜ëŠ” targetì˜ ë¶€ëª¨ì˜ elementì˜ styleì„ ë³€ê²½
  ```
  e.target.parentElement.style.opacity = 0;
  setTimeout(() => {
  	e.target.parentElement.style.display = "none";
  }, 1000);
  ```
- ajaxì—ì„œ fetch urlì— query stringìœ¼ë¡œ ê°’ì„ ë³´ë‚¼ ìˆ˜ ìˆìŒ _`fetch_("/api/test?name=kim&age=20");`
  ```jsx
  export default function handler(req, res) {
    **console.log(req.query); // { name: 'kim', age: '20' }**
    return res.status(200).json("ì„±ê³µ");
  }
  ```
- ê°„ë‹¨í•˜ê³ , GET ìš”ì²­ì€ bodyë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ëŠ”ë° query stringì„ ì´ìš©í•˜ë©´ ë³´ë‚¼ ìˆ˜ ìˆìŒ / ë‹¨ì ì€ ë°ì´í„°ê°€ ë§ìœ¼ë©´ ë”ëŸ½ê³  ë¯¼ê°í•œ ì •ë³´ëŠ” ë‹´ìœ¼ë©´ ê³¤ë€í•¨
- url parameter í˜•ì‹ìœ¼ë¡œ dynamic route í´ë” êµ¬ì¡° ë§Œë“¤ ë“¯ì´ page\api\abc\[ì–´ì©Œêµ¬].js ì´ëŸ° í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë©´ í•´ë‹¹ api url ì–´ì©Œêµ¬ì— ì•„ë¬´ ê°’ì´ ë“¤ì–´ê°€ë„ { ì–´ì©Œêµ¬: value }ë¡œ ë‚˜ì˜´
  - ì„œë²„ì—ì„œëŠ” query stringì²˜ëŸ¼ `console.log(req.query);` ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŒ
  - íŒŒì¼ëª… ë¿ë§Œ ì•„ë‹ˆë¼ í´ë”ëª…ì— ëŒ€ê´„í˜¸ë¡œ ì„¸íŒ…í•˜ëŠ” ê±° ê°€ëŠ¥
- ìš”ì•½ì •ë¦¬
  - DB document ì‚­ì œëŠ” deleteOne
  - ì„œë²„ë‘ ajaxë¡œ í†µì‹ ê°€ëŠ¥
  - ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ ì‹œ ê·€ì°®ìœ¼ë©´ query stringì´ë‚˜ url parameter ë¬¸ë²• ì‚¬ìš© ê°€ëŠ¥

## static rendering, dynamic rendering, cache

### í”„ë¡œì íŠ¸ ë°°í¬í•˜ë ¤ë©´

- npm run buildë¥¼ í†µí•´ buildëœ ê²°ê³¼ë¬¼ì„ ì–»ì–´ì•¼ í•¨
- í•´ë‹¹ ëª…ë ¹ì–´ë¡œ ë¹Œë“œí•œ í›„ì— í„°ë¯¸ë„ì„ ë³´ë©´,
  - O â†’ static rendering â†’ (ë””í´íŠ¸) npm run build í•  ë•Œ ë§Œë“  html í˜ì´ì§€ ê·¸ëŒ€ë¡œ ìœ ì €ì—ê²Œ ë³´ëƒ„ â†’ ê°’ì´ ë³€í•´ë„ ìµœì´ˆì— npm run build í–ˆì„ ë•Œ ë‚˜ì˜¨ í˜ì´ì§€ë§Œ ë³´ë‚´ì¤Œ
  - Î» â†’ dynamic rendering â†’ ìœ ì €ê°€ í˜ì´ì§€ ì ‘ì†ë§ˆë‹¤ html ìƒˆë¡œ ë§Œë“¤ì–´ì„œ ë³´ë‚´ì¤Œ
    - `fetch(â€™/â€™, { cache: â€˜no-storeâ€™ }` / `useSearchParams()` / `cookies()` / `headers()` / `[dynamic route]` ê´€ë ¨ í•¨ìˆ˜ ë“±ì„ ì‚¬ìš©í–ˆì„ ë•Œ í˜ì´ì§€ì—ì„œ ìë™ìœ¼ë¡œ dynamic renderingìœ¼ë¡œ ë°”ê¿”ì¤Œ
- ê¸°ì¡´ list í˜ì´ì§€ ê°™ì€ ê²½ìš° ê¸€ì´ ë“±ë¡/ì‚­ì œ/ìˆ˜ì •ë˜ì—ˆì„ ë•Œ ìƒˆë¡œ í˜ì´ì§€ë¥¼ ê·¸ë ¤ì¤˜ì•¼ í•˜ëŠ” ì´ìŠˆ â†’ `export const dynamic = 'force-dynamic'`ë¼ëŠ” ì˜ˆì•½ëœ ë³€ìˆ˜ë¥¼ í†µí•´ì„œ ë³€ê²½

  ```jsx
  import { connectDB } from "@/util/database";
  import ListItem from "./ListItem";

  export const dynamic = "force-dynamic";

  export default async function List() {
    const db = (await connectDB).db("forum");
    let result = await db.collection("post").find().toArray();
    console.log("result", result);

    return (
      <div className="list-bg">
        <ListItem result={result} />
      </div>
    );
  }
  ```

- dynamic rendering ë‹¨ì  â†’ ì„œë²„/DB ë¶€ë‹´ ì¦ê°€ â†’ **ë¶€ë‹´ìŠ¤ëŸ¬ìš°ë©´ ìºì‹± ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥**

  - í˜ì´ì§€ ìºì‹±: í˜ì´ì§€ ì™„ì„±ë³¸ì„ ì ê¹ ì €ì¥í•´ë‘ê³  ì¬ì‚¬ìš©
  - GETìš”ì²­ ê²°ê³¼ ìºì‹±: GETìš”ì²­ê²°ê³¼ë¥¼ ì ê¹ ì €ì¥í•´ë‘ê³  ì¬ì‚¬ìš© ê°€ëŠ¥

- ìºì‹± ì˜ˆì‹œ

  - ë’¤ì— cache ì˜µì…˜ì´ ì—†ì–´ë„ ìë™ìœ¼ë¡œ cacheê°€ ë¨

    ```jsx
    export default async function Home() {
      await fetch("/URL", { cache: "force-cache" }); // ë’¤ì— cache ì˜µì…˜ì´ ì—†ì–´ë„ ìë™ìœ¼ë¡œ cacheê°€ ë¨

      return <div>test</div>;
    }
    ```

  - ìºì‹± ì—†ì´ ì‹¤ì‹œê°„ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ì ìš© ì˜µì…˜

    ```jsx
    export default async function Home() {
      await fetch("/URL", { cache: "no-store" }); // ìºì‹± ì—†ì´ ì‹¤ì‹œê°„ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ì ìš© ì˜µì…˜

      return <div>test</div>;
    }
    ```

  - ì§€ì •ëœ ì‹œê°„ë§ˆë‹¤ ìºì‹± ê°€ëŠ¥

    ```jsx
    export default async function Home() {
      await fetch("/URL", { next: { revalidate: 60 } }); // ì´ëŸ¬ë©´ 60ì´ˆë§ˆë‹¤ ìºì‹±ëœ ë°ì´í„° ê°±ì‹ í•´ì¤Œ, 1ì´ˆë§ˆë‹¤ ì‹¤ì‹œê°„ ë°ì´í„°ê°€ í•„ìš” ì—†ëŠ” ê±´ ì´ë ‡ê²Œ ìºì‹±í•´ë‘ë©´ ìì›ì„ ì ˆì•½í•  ìˆ˜ ìˆìŒ

      return <div>test</div>;
    }
    ```

  - revalidate ì˜ˆì•½ ë³€ìˆ˜ ì“°ë©´ í˜ì´ì§€ ë‹¨ìœ„ ìºì‹± ê°€ëŠ¥

    ```jsx
    import { connectDB } from "@/util/database.js";

    export const revalidate = 60; // ëˆ„ê°€ í˜ì´ì§€ ë°©ë¬¸ì‹œ 60ì´ˆ ë™ì•ˆ í˜ì´ì§€ê°€ ìºì‹±ë©ë‹ˆë‹¤

    export default async function Home() {
      const client = await connectDB;
      const db = client.db("forum");
      let result = await db.collection("post").find().toArray();

      return <div>test</div>;
    }
    ```

## JWT, session, OAuth ì„¤ëª…ì‹œê°„

- ë¸Œë¼ìš°ì € ë‚´ ì¿ í‚¤ì— ì €ì¥ëœ ì •ë³´ëŠ” GET/POST ìš”ì²­í•  ë•Œ ìë™ìœ¼ë¡œ ê°™ì´ ì„œë²„ì— ì „ì†¡ë¨ â†’ ì¦‰ ë¡œê·¸ì¸í–ˆì„ ë•Œ ì…ì¥ê¶Œì„ ì¿ í‚¤ì— ì €ì¥í•¨
- ì…ì¥ê¶Œ ë§Œë“¤ ë•Œ â†’ session ë°©ì‹ / token ë°©ì‹
- session ë°©ì‹
  - ì…ì¥ê¶Œì—ëŠ” session id (ì´ê²ƒë§Œ ì í˜€ ìˆìŒ)
  - ì¥ì : ìœ ì €ì˜ GET/POST ë“± ìš”ì²­ë§ˆë‹¤ ì—„ê²©í•˜ê²Œ ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬ ê°€ëŠ¥
  - ë‹¨ì : DBì— ë¬´ë¦¬ê°€ ê°ˆ ìˆ˜ ìˆìŒ
- token ë°©ì‹(ì‚¬ì‹¤ìƒ ëŒ€ë¶€ë¶„ JWT(JSON Web Token))
  - ì…ì¥ê¶Œì— ì•„ì´ë””/ë¡œê·¸ì¸ë‚ ì§œ/ìœ íš¨ê¸°ê°„ ë“±ì„ ë‹´ê³  ì•”í˜¸í™”ë¥¼ ì‹œì¼œì„œ ìœ ì €í•œí…Œ ë³´ëƒ„
  - ìœ ì €ì˜ GET/POST ë“±ì˜ ìš”ì²­ì´ ìˆì„ ë•Œë§ˆë‹¤ ì„œë²„ì—ì„œ ì²´í¬
  - ì¥ì : DBë¥¼ ìì£¼ ì¡°íšŒí•˜ì§€ ì•Šì•„ë„ ë¨ â†’ ìœ ì €ê°€ ë§ê±°ë‚˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ìš´ì˜ì¤‘ì´ë©´ ì¢‹ìŒ
- OAuth

  - íƒ€ ì‚¬ì´íŠ¸ë¥¼ í†µí•œ ì„œë¹„ìŠ¤ ì´ìš©
    ![Untitled](../assets/396701c626b6.png)
  - ì†Œì…œ ë¡œê·¸ì¸
    ![Untitled](../assets/cb7a2d99ce23.png)

- Next.jsì—ì„œ íšŒì›ê¸°ëŠ¥ êµ¬í˜„ â†’ NextAuth.js, Auth.js ì£¼ë¡œ ì‚¬ìš©
  - ì†Œì…œë¡œê·¸ì¸, ì•„ì´ë””/ë¹„ë²ˆë¡œê·¸ì¸, JWT, Session, DB adapter
  - ì•„ì´ë””/ë¹„ë²ˆë¡œê·¸ì¸ì‹œ JWT ê°•ì œë¡œ ì‚¬ìš©í•´ì•¼ í•¨(session ê¸ˆì§€)
    - â€œê°œë°œìê°€ ì§ì ‘ ì•„ì•„ë””/ë¹„ë²ˆ ì·¨ê¸‰í•˜ë©´ ë³´ì•ˆì´ìŠˆê°€ ìƒê¸¸ ìˆ˜ ìˆì–´ ê¸ˆì§€í•¨â€ - NextAuth ì„¤ëª…ì„œ

## íšŒì›ê¸°ëŠ¥ ë§Œë“¤ê¸° : Auth.js ì‚¬ìš©í•œ ì†Œì…œë¡œê·¸ì¸

- ì†Œì…œë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ë ¤ë©´ ê° ì‚¬ì´íŠ¸ë§ˆë‹¤ ì„¸íŒ…ì´ í•„ìš”í•¨
  ex) GitHub â†’ Settings > Developer settings > OAuth App ì„¸íŒ… í•„ìš” â†’ (ì°¸ê³ ) GitHub OAuth Appì´ ì—¬ëŸ¬ ê°œì¼ ê²½ìš° ê°ê° ë™ì¼í•œ urlì„ ì ìœ¼ë©´ ì•ˆë¨
- `npm i next-auth@4.21.1`
- pages\api\auth\[â€¦nextauth].js íŒŒì¼ ìƒì„±í•´ì„œ ì„¸íŒ…

  ```jsx
  // pages\api\auth\[...nextauth].js

  import NextAuth from "next-auth";
  import GithubProvider from "next-auth/providers/github";

  export const authOptions = {
    providers: [
      GithubProvider({
        clientId: "Githubì—ì„œ ë°œê¸‰ë°›ì€ID",
        clientSecret: "Githubì—ì„œ ë°œê¸‰ë°›ì€Secret",
      }),
    ],
    secret: "jwtìƒì„±ì‹œì“°ëŠ”ì•”í˜¸",
  };
  export default NextAuth(authOptions);
  ```

  - ë¡œê·¸ì¸ ë°©ì‹ í•˜ë‚˜ë¥¼ providerë¼ê³  í•¨
  - ì†Œì…œ ë¡œê·¸ì¸ì€ ê¸°ë³¸ì ìœ¼ë¡œ JWTë¥¼ ì‚¬ìš©í•¨ â†’ ì•”í˜¸ ê°™ì€ ê±¸ ë„£ì–´ì¤˜ì•¼ í•¨
  - ê·¸ í›„ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë‚´ì¥ëœ _`signIn_()` ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„
  - _`````signOut_()` ì€ ë¡œê·¸ì•„ì›ƒ
  - í•´ë‹¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ë¥¼ í™•ì¸í•˜ê±°ë‚˜ í™œìš©í•˜ê³  ì‹¶ìœ¼ë©´, _`getServerSession()`_

    - await ì“°ê²Œë” ë˜ì–´ ìˆìŒ
    - authOptions í•„ìš”í•¨

    ```jsx
    // app\layout.js

    import Link from "next/link";
    import "./globals.css";
    import { Inter } from "next/font/google";
    import LoginBtn from "./LoginBtn";
    import LogoutBtn from "./LogoutBtn";
    import { getServerSession } from "next-auth";
    import { authOptions } from "@/pages/api/auth/[...nextauth]";

    const inter = Inter({ subsets: ["latin"] });

    export const metadata = {
      title: "Create Next App",
      description: "Generated by create next app",
    };

    export default async function RootLayout({ children }) {
      let session = await getServerSession(authOptions);
      console.log(session);

      return (
        <html lang="en">
          <body>
            <div className="navbar">
              <Link href="/" className="logo">
                Appleforum
              </Link>
              <Link href="/list">List</Link>
              {!session ? <LoginBtn /> : <LogoutBtn />}
            </div>
            {children}
          </body>
        </html>
      );
    }
    ```

    ```jsx
    // LoginBtn.js

    "use client";

    import { signIn } from "next-auth/react";

    export default function LoginBtn() {
      return (
        <button
          onClick={() => {
            signIn();
          }}
        >
          ë¡œê·¸ì¸
        </button>
      );
    }
    ```

    ```jsx
    LogoutBtn.js;

    ("use client");

    import { signOut } from "next-auth/react";

    export default function LogoutBtn() {
      return (
        <button
          onClick={() => {
            signOut();
          }}
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      );
    }
    ```

## íšŒì›ê¸°ëŠ¥ ë§Œë“¤ê¸° : OAuth + sessionë°©ì‹ ì‚¬ìš©í•˜ê¸°

- session ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤ â†’ DB adapter ì‚¬ìš©
  1. ì²« ë¡œê·¸ì¸ ì‹œ ìë™íšŒì›ê°€ì… (DBì— ë³´ê´€)
  2. ë¡œê·¸ì¸ ì‹œ DBì— ì„¸ì…˜ì •ë³´ ë³´ê´€
  3. í˜„ì¬ ë¡œê·¸ì¸ëœ ìœ ì € ì •ë³´ í•„ìš”í•˜ë©´ DBì—ì„œ ì¡°íšŒí•´ë´„
- npm install @next-auth/mongodb-adapter
  - ë‹¤ë¥¸ DB ì“°ë ¤ë©´ ë‹¤ë¥¸ DB adapter ì°¾ì•„ì„œ ì‚¬ìš© ê°€ëŠ¥
- ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì„ ë„£ê¸° ìœ„í•´ ìœ ì € íŒë³„ì´ í•„ìš”í•  ë• `getServerSession()` ìœ¼ë¡œ ìœ ì € ì •ë³´ë¥¼ ê¸€ì— ë‹´ì•„ì¤˜ì•¼ í•¨
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹´ì•„ì¤˜ë„ ë˜ì§€ë§Œ ì„œë²„ì—ì„œ `getServerSession()` ì‹¤í–‰í•  ë• request, response ê°™ì´ ì¸ìë¡œ ë³´ë‚´ì¤˜ì•¼ í•¨

  ```jsx
  // pages\api\post\new.js

  import { connectDB } from "@/util/database";
  import { getServerSession } from "next-auth";
  import { authOptions } from "../auth/[...nextauth]";

  export default async function handler(req, res) {
    let session = await getServerSession(req, res, authOptions);
    if (session) {
      req.body.author = session.user.email;
    }

    if (req.method === "POST") {
      if (req.body.title === "") {
        return res.status(500).json("ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤");
      }

      try {
        const db = (await connectDB).db("forum");
        let result = await db.collection("post").insertOne(req.body);
        return res.status(200).redirect("/list");
      } catch (error) {
        console.log(error);
      }
    }
  }
  ```

## íšŒì›ê¸°ëŠ¥ ë§Œë“¤ê¸° : ì•„ì´ë””/ë¹„ë²ˆ + JWT ì‚¬ìš©í•˜ê¸°

- ì•„ì´ë””/ë¹„ë²ˆ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ â†’ CredentialsProvider() ì‚¬ìš© â†’ ë‹¨, JWTë§Œ ì‚¬ìš© ê°€ëŠ¥
- DBì— ë¹„ë°€ë²ˆí˜¸ëŠ” ë°”ë¡œ ì €ì¥í•˜ì§€ ë§ê³  ì•”í˜¸í™”í•´ì„œ ì €ì¥ í•„ìš” â†’ npm i bcrypt

  ```jsx
  import { connectDB } from "@/util/database";
  import bcrypt from "bcrypt";

  export default async function handler(req, res) {
    if (req.method === "POST") {
      let hash = await bcrypt.hash(req.body.password, 10); // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
      req.body.password = hash; // ê¸°ì¡´ bodyì— passwordê°’ì„ hashë¡œ ëŒ€ì²´
      let db = (await connectDB).db("forum");
      await db.collection("user_cred").insertOne(req.body);
      res.status(200).json("íšŒì›ê°€ì…ì„±ê³µ");
    }
  }
  ```

- CredentialsProviderë¥¼ ì‚¬ìš©í•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ”ë°, ë¡œê·¸ì¸í˜ì´ì§€ì— ë“¤ì–´ê°ˆ inputë“¤ì€ ì„¤ì •í•´ì¤˜ì•¼ í•¨

  ```jsx
  // pages\api\auth\[...nextauth].js

  import { connectDB } from "@/util/database";
  import { MongoDBAdapter } from "@next-auth/mongodb-adapter";
  import NextAuth from "next-auth";
  import GithubProvider from "next-auth/providers/github";
  import CredentialsProvider from "next-auth/providers/credentials";
  import bcrypt from "bcrypt";

  export const authOptions = {
    providers: [
      GithubProvider({
        clientId: "clientId", // GitHubì—ì„œ í™•ì¸í•œ clientId
        clientSecret: "clientSecret", // GitHubì—ì„œ í™•ì¸í•œ clientSecret
      }),

      CredentialsProvider({
        //1. ë¡œê·¸ì¸í˜ì´ì§€ í¼ ìë™ìƒì„±í•´ì£¼ëŠ” ì½”ë“œ
        name: "credentials",
        credentials: {
          email: { label: "email", type: "text" },
          password: { label: "password", type: "password" },
        },

        //2. ë¡œê·¸ì¸ìš”ì²­ì‹œ ì‹¤í–‰ë˜ëŠ”ì½”ë“œ
        //ì§ì ‘ DBì—ì„œ ì•„ì´ë””,ë¹„ë²ˆ ë¹„êµí•˜ê³ 
        //ì•„ì´ë””,ë¹„ë²ˆ ë§ìœ¼ë©´ return ê²°ê³¼, í‹€ë¦¬ë©´ return null í•´ì•¼í•¨
        async authorize(credentials) {
          let db = (await connectDB).db("forum");
          let user = await db
            .collection("user_cred")
            .findOne({ email: credentials.email });
          if (!user) {
            console.log("í•´ë‹¹ ì´ë©”ì¼ì€ ì—†ìŒ");
            return null;
          }
          const pwcheck = await bcrypt.compare(
            // ë¹„ë°€ë²ˆí˜¸ ë¹„êµ
            credentials.password,
            user.password
          );
          if (!pwcheck) {
            console.log("ë¹„ë²ˆí‹€ë¦¼");
            return null;
          }
          return user;
        },
      }),
    ],

    //3. jwt ì¨ë†”ì•¼ ì˜ë©ë‹ˆë‹¤ + jwt ë§Œë£Œì¼ì„¤ì •
    session: {
      strategy: "jwt", // session or jwt
      maxAge: 30 * 24 * 60 * 60, // ë¡œê·¸ì¸ ìœ ì§€ê¸°ê°„(30ì¼)
    },

    callbacks: {
      //4. jwt ë§Œë“¤ ë•Œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
      //userë³€ìˆ˜ëŠ” DBì˜ ìœ ì €ì •ë³´ë‹´ê²¨ìˆê³  token.userì— ë­ ì €ì¥í•˜ë©´ jwtì— ë“¤ì–´ê°‘ë‹ˆë‹¤.
      jwt: async ({ token, user }) => {
        if (user) {
          token.user = {};
          token.user.name = user.name;
          token.user.email = user.email;
        }
        return token;
      },
      //5. ìœ ì € ì„¸ì…˜ì´ ì¡°íšŒë  ë•Œ ë§ˆë‹¤ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
      session: async ({ session, token }) => {
        session.user = token.user;
        return session;
      },
    },
    secret: "qwe213",
    adapter: MongoDBAdapter(connectDB),
  };
  export default NextAuth(authOptions);
  ```

- user roleì„ ë‚˜ëˆ„ê³  ì‹¶ìœ¼ë©´ ê°€ì…í•  ë•Œ role: normal ì •ë³´ ê°™ì€ ê±° ë„£ì–´ì¤Œ role-based auth

## ëŒ“ê¸€ê¸°ëŠ¥ ë§Œë“¤ê¸° 1 (input ë°ì´í„° ë‹¤ë£¨ê¸°)

- ëŒ“ê¸€ì€ ìƒˆë¡œê³ ì¹¨ ì—†ì´ í™”ë©´ì„ ìƒˆë¡œ ê·¸ë ¤ì£¼ëŠ” ê²Œ ë‚˜ìœ¼ë‹ˆ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ë§Œ clientë¡œ ë½‘ì•„ì„œ ajax ì ìš©
- ê¸°ì¡´ documentì— í•´ë‹¹ ëŒ“ê¸€ ë°ì´í„°ë¥¼ ì €ì¥í•´ë„ ë˜ì§€ë§Œ document 1ê°œë‹¹ ìµœëŒ€ 8ë©”ê°€ ì œí•œë„ ìˆê³  ëŒ“ê¸€ ìˆ˜ì • ë° ì‚­ì œê°€ ê¹Œë‹¤ë¡œì›€, array ì•ˆì— ìë£Œ ë§ìœ¼ë©´ ìˆ˜ì •/ì‚­ì œ ê¹Œë‹¤ë¡œì›€
- ë³„ë„ì˜ comment collectionì„ ë§Œë“¤ì–´ì„œ ë”°ë¡œ ì €ì¥í•´ë„ ì¢‹ìŒ â†’ ë‹¤ë§Œ ì–´ë–¤ ê¸€ì— ë‹¬ë ¸ëŠ”ì§€ ì•Œì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì— í•˜ë‹¨ì²˜ëŸ¼ parent í•„ìš”
  ```
  _id: ObjectId('12831e319a31a9s313');
  content: 'ëŒ“ê¸€ì„',
  author: 'test@test.com',
  parent: 'ObjectId(ë¶€ëª¨ê²Œì‹œë¬¼ì˜ _id);
  ```
- DBì €ì¥ì‹œ ì´ê²Œ ë§ëŠ”ì§€ ëª¨ë¥´ê² ë‹¤ë©´ â†’ ë‚˜ì¤‘ì— ìˆ˜ì •, ì‚­ì œ, ì¶œë ¥ ì‰¬ìš°ë©´ ì˜í•œ ê±°ì„ â†’ ìˆ˜ì •/ì‚­ì œ/ì¶œë ¥ ì–´ë ¤ìš°ë©´ ë‹¤ë¥¸ documentë¡œ ë¹¼ë³´ì

## ëŒ“ê¸€ê¸°ëŠ¥ ë§Œë“¤ê¸° 2 (useEffect)

```jsx
// app\detail\[id]\page.js

import { connectDB } from "@/util/database";
import { ObjectId } from "mongodb";
import Comment from "./Comment";

export default async function Detail(props) {
  const db = (await connectDB).db("forum");
  let result = await db
    .collection("post")
    .findOne({ _id: new ObjectId(props.params.id) });
  return (
    <div>
      <h4>ìƒì„¸í˜ì´ì§€</h4>
      <h4>{result.title}</h4>
      <p>{result.content}</p>
      <Comment _id={result._id} />
    </div>
  );
}
```

```jsx
// app\detail\[id]\Comment.js

"use client";

import { useEffect, useState } from "react";

export default function Comment(props) {
  let [comment, setComment] = useState("");

  return (
    <div>
      <div>ëŒ“ê¸€ëª©ë¡ë³´ì—¬ì¤„ë¶€ë¶„</div>
      <input
        type="text"
        onChange={(e) => {
          setComment(e.target.value);
        }}
      />
      <button
        onClick={() => {
          fetch("/api/comment/new", {
            method: "POST",
            body: JSON.stringify({ comment: comment, _id: props._id }),
          });
        }}
      >
        ëŒ“ê¸€ì „ì†¡
      </button>
    </div>
  );
}
```

```jsx
// pages\api\comment\new.js

import { connectDB } from "@/util/database";
import { ObjectId } from "mongodb";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]";

export default async function handler(req, res) {
  let session = await getServerSession(req, res, authOptions);
  req.body = JSON.parse(req.body);
  if (req.method == "POST") {
    let params = {
      content: req.body.comment,
      parent: new ObjectId(req.body._id),
      author: session.user.email,
    };
    let db = (await connectDB).db("forum");
    let result = await db.collection("comment").insertOne(params);
    res.status(200).json("ëŒ“ê¸€ì €ì¥ì™„ë£Œ");
  }
}
```

## ëŒ“ê¸€ê¸°ëŠ¥ ë§Œë“¤ê¸° 3 (ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°)

```jsx
// app\detail\[id]\pages.js

import { connectDB } from "@/util/database";
import { ObjectId } from "mongodb";
import Comment from "./Comment";

export default async function Detail(props) {
  const db = (await connectDB).db("forum");
  let result = await db
    .collection("post")
    .findOne({ _id: new ObjectId(props.params.id) });
  return (
    <div>
      <h4>ìƒì„¸í˜ì´ì§€</h4>
      <h4>{result.title}</h4>
      <p>{result.content}</p>
      <Comment _id={result._id} />
    </div>
  );
}
```

```jsx
// app\detail\[id]\Comment.js

"use client";

import { useEffect, useState } from "react";

export default function Comment(props) {
  let [comment, setComment] = useState("");
  let [data, setData] = useState([]);

  useEffect(() => {
    fetch(`/api/comment/list?id=${props._id}`)
      .then((r) => r.json())
      .then((result) => {
        console.log(result);
        setData(result);
      });
  }, []);

  return (
    <div>
      {data
        ? data.map((item) => {
            return <p key={item._id}>{item.content}</p>;
          })
        : null}

      <input
        type="text"
        onChange={(e) => {
          setComment(e.target.value);
        }}
      />
      <button
        onClick={() => {
          fetch("/api/comment/new", {
            method: "POST",
            body: JSON.stringify({ comment: comment, _id: props._id }),
          });
        }}
      >
        ëŒ“ê¸€ì „ì†¡
      </button>
    </div>
  );
}
```

```jsx
// pages\api\comment\list.js

import { connectDB } from "@/util/database";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const db = (await connectDB).db("forum");
  let result = await db
    .collection("comment")
    .find({ parent: new ObjectId(req.query.id) })
    .toArray();
  res.status(200).json(result);
}
```

- MySQL ë“± ê´€ê³„í˜• DBëŠ” ìœ ì € ì´ë¦„ì´ë‚˜ ìœ ì € ì´ë©”ì¼ì„ ë‹¤ë¥¸ í…Œì´ë¸”ì— ì €ì¥í•˜ëŠ” ê²Œ ì•ˆ ì¢‹ì€ ê´€ìŠµì´ì§€ë§Œ ë¹„ê´€ê³„í˜•ì—ëŠ” ì‚¬ê´€ ì—†ê±°ë‹ˆì™€ ê´œì°®ì€ ê´€ìŠµ(ë§ì€ ì •ë³´ë¥¼ ì €ì¥)

## loading.js, error.js, not-found.js

- loading.js
  - ëª¨ë“  page.js ì˜†ì— loading.js ìƒì„± ê°€ëŠ¥
  - ë¦¬ì•¡íŠ¸ Suspense
    ```jsx
    <Suspense fallback={<div>ë¡œë”©ì¤‘</div>}>
      <div>ë³´ì—¬ì¤„í˜ì´ì§€</div>
    </Suspense>
    ```
  - í•´ë‹¹ í´ë” page.js ì˜†ì— loading.jsê°€ ì—†ë”ë¼ë„ ìƒìœ„ë¥¼ ì„œì¹˜í•˜ê¸° ë•Œë¬¸ì— ìµœìƒë‹¨ì— í•˜ë‚˜ë§Œ ë‘ëŠ” ê²ƒë„ ê°€ëŠ¥
- error.js
  - ëª¨ë“  page.js ì˜†ì— error.js ë§Œë“¤ê³ ,
  - ë¬´ì¡°ê±´ â€˜use clientâ€™
  - props í™•ì¸í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ error, resetì´ ìˆëŠ”ë° í™œìš© ê°€ëŠ¥
  - page.jsì—ì„œ ì—ëŸ¬ê°€ ë‚˜ë©´ error.js ë³´ì—¬ì¤Œ
    - í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ ì˜ì—­ë§Œ error.js ë¥¼ ë³´ì—¬ì£¼ê¸° ë•Œë¬¸ì— header ë“± ë‹¤ë¥¸ ê³µí†µ ì»´í¬ë„ŒíŠ¸ê°€ ë‚¨ì•„ ìˆì–´ì„œ ìƒëŒ€ì ìœ¼ë¡œ ê¹”ë”í•¨
  - í•´ë‹¹ í´ë” page.js ì˜†ì— error.jsê°€ ì—†ë”ë¼ë„ ìƒìœ„ë¥¼ ì„œì¹˜í•˜ê¸° ë•Œë¬¸ì— ìµœìƒë‹¨ì— í•˜ë‚˜ë§Œ ë‘ëŠ” ê²ƒë„ ê°€ëŠ¥
  - error.jsëŠ” ì˜†ì— ìˆëŠ” layout.jsëŠ” ì—ëŸ¬ ì²´í¬ ëª»í•¨
    - global-error.js ë§Œë“¤ë©´ ìµœìƒë‹¨ layout.js ì—ëŸ¬ ì²´í¬ ê°€ëŠ¥
- not-found.js (404 not found)
  - Next.js ê¸°ë³¸ ë‚´ì¥ëœ 404 í˜ì´ì§€ê°€ ìˆìŒ
  - ëª¨ë“  page.js ì˜†ì— not-found.js ìƒì„± ê°€ëŠ¥
  - notFound()ë¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ í•´ë‹¹ not-found.js ì¶œë ¥ ê°€ëŠ¥

## AWS Elastic Beanstalkì— Next.jsì„œë²„ ë°°í¬

ì´ ë°‘ìœ¼ë¡œë¶€í„°ëŠ” ì¶”í›„ ì²´í¬ ì˜ˆì •
